/*! jquery.spriteAnimation - v0.2.1 - 2013-08-19
* https://github.com/gunderson/jquery.spriteAnimation
* Copyright (c) 2013 Patrick Gunderson; Licensed MIT */
(function(e){e.spriteAnimation=function(t,n){var r=this;return r.$el=e(t),r.el=t,r.currentFrameIndex=0,r.running=!1,r.timeout=null,r.$el.data("spriteAnimation",r),r.init=function(){r.el=t,r.options=e.extend({},e.spriteAnimation.options,n),r.$el=e(this.el),r.setFrameRate(r.options.frameRate)},r.generate=function(){r.$anim=e("<div/>").addClass("spriteAnimation"),r.$anim.css({backgroundImage:"url("+r.options.src+")",backgroundPosition:r.options.currentSequence.firstFramePosition.x+"px "+r.options.currentSequence.firstFramePosition.y+"px",width:r.options.frameWidth,height:r.options.frameHeight,overflow:"hidden"}),r.$el.append(r.$anim)},r.setFrameRate=function(e){return r.frameRate=e,r.frameDelay=1e3/e,r},r.play=function(){return r.running=!0,r.options.currentSequence.reverse=!1,r.delayNextFrame(),r},r.rewind=function(){return r.running=!0,r.options.currentSequence.reverse=!0,r.delayPrevFrame(),r},r.stop=function(){return r.timeout&&clearTimeout(r.timeout),r.running=!1,r},r.reset=function(){return r.stop(),r.currentFrameIndex=0,r.gotoFrame(0),r},r.gotoFrame=function(e){var t=-r.options.currentSequence.firstFramePosition.x;"x"===r.options.orientation&&(t=-e*(r.options.frameWidth+r.options.frameSpacing)-r.options.currentSequence.firstFramePosition.x);var n=-r.options.currentSequence.firstFramePosition.y;return"y"===r.options.orientation&&(n=-e*(r.options.frameHeight+r.options.frameSpacing)-r.options.currentSequence.firstFramePosition.y),r.$anim.css({backgroundPosition:t+"px "+n+"px"}),r.options.currentSequence.reverse?r.delayPrevFrame():r.delayNextFrame(),r},r.nextFrame=function(){return++r.currentFrameIndex<r.options.currentSequence.length?r.gotoFrame(r.currentFrameIndex):r.options.currentSequence.loop?(r.currentFrameIndex=0,r.$el.trigger("spriteAnimation:loop"),r.$el.trigger("spriteAnimation:loop-to-start"),r.gotoFrame(r.currentFrameIndex)):(r.complete(),r.stop())},r.prevFrame=function(){return--r.currentFrameIndex>=0?r.gotoFrame(r.currentFrameIndex):r.options.currentSequence.loop?(r.currentFrameIndex=r.options.currentSequence.length,r.$el.trigger("spriteAnimation:loop"),r.$el.trigger("spriteAnimation:loop-to-end"),r.gotoFrame(r.currentFrameIndex)):(r.complete(),r.stop())},r.delayNextFrame=function(){r.running&&(r.timeout=setTimeout(function(){r.nextFrame()},r.frameDelay))},r.delayPrevFrame=function(){r.running&&(r.timeout=setTimeout(function(){r.prevFrame()},r.frameDelay))},r.addSequence=function(t){r.options.sequences[t.label]=e.extend({},r.options.defaultSequence,t)},r.complete=function(){"function"==typeof r.options.currentSequence.onComplete&&r.options.currentSequence.onComplete(),r.$el.trigger("spriteAnimation:complete"),r.$el.trigger("spriteAnimation:complete:"+r.options.currentSequence.label)},r.init(),r},e.spriteAnimation.options={src:"",sequences:{},defaultSequence:{label:"a",length:25,loop:!1,firstFramePosition:{x:0,y:0},reverse:!1,onComplete:null},orientation:"x",frameWidth:25,frameHeight:25,frameSpacing:0,frameRate:60,gotoAndPlay:"a"},e.fn.spriteAnimation=function(t){return this.each(function(){var n,r,o=e(this);if(t=t||{},!(r=this.spriteAnimation)){if(!t.src){if(!(t.src=o.css("backgroundImage"))&&!(t.src=o.attr("src")))return console?console.error("SpriteAnimation requires image src."):!1,this;o.css("backgroundImage","none"),o.attr("src",""),"url("===t.src.substr(0,4)&&(t.src=t.src.replace("url(","").replace(")",""))}t.frameWidth||(t.frameWidth=o.width()),t.frameHeight||(t.frameHeight=o.height()),this.spriteAnimation=r=new e.spriteAnimation(this,n),t.addSequences||t.addSequence?n=e.extend({},e.spriteAnimation.options,t):(n=e.extend({},e.spriteAnimation.options),t.label=t.label||"a",t.addSequence=e.extend({},t,{addSequence:null}),t.setSequence=t.label)}return t&&"object"==typeof t&&(e.extend(r.options,t),t.addSequences&&e.each(t.addSequences,function(e){this.label=e,r.addSequence(this)}),t.addSequence&&(t.addSequence.label||(t.label="a"+r.sequences.length),r.addSequence(t.addSequence)),t.gotoAndPlay&&(t.setSequence=t.gotoAndPlay,t.command="play"),t.setSequence&&(r.options.currentSequence=r.options.sequences[t.setSequence],t.gotoFrame=t.gotoFrame||0),r.$anim||r.generate(),t.frameRate&&r.setFrameRate(t.frameRate),(t.gotoFrame>=0||t.gotoFrame)&&("end"===t.gotoFrame&&(t.gotoFrame=r.options.currentSequence.length-1),r.stop(),r.currentFrameIndex=t.gotoFrame,r.gotoFrame(t.gotoFrame)),t.gotoFrameRatio>=0&&(t.gotoFrameRatio=Math.max(Math.min(t.gotoFrameRatio,1),0),r.currentFrameIndex=t.gotoFrameRatio*r.options.currentSequence.length>>0,r.gotoFrame(r.currentFrameIndex)),t.command&&(t=t.command)),t&&"string"==typeof t?(r.$anim||r.generate(),"play"===t&&r.play(),"rewind"===t&&r.rewind(),"stop"===t&&r.stop(),"reset"===t&&r.reset()):t&&!isNaN(parseInt(t,10))?r.gotoFrame(t):t||r.reset(),this})}})(jQuery);