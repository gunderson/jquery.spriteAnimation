/*! jquery.spriteAnimation - v0.2.0 - 2013-08-13
* https://github.com/gunderson/jquery.spriteAnimation
* Copyright (c) 2013 Patrick Gunderson; Licensed MIT */
(function(e){e.spriteAnimation=function(n,t){var r=this;return r.$el=e(n),r.el=n,r.currentFrameIndex=0,r.running=!1,r.timeout=null,r.$el.data("spriteAnimation",r),r.init=function(){r.el=n,r.options=e.extend({},e.spriteAnimation.options,t),r.$el=e(this.el),r.setFrameRate(r.options.frameRate)},r.generate=function(){r.$anim=e("<div/>").addClass("spriteAnimation");var n=r.options.frameWidth||r.$el.width(),t=r.options.frameHeight||r.$el.height();r.$anim.css({backgroundImage:"url("+r.options.src+")",backgroundPosition:r.options.currentSequence.firstFramePosition.x+"px "+r.options.currentSequence.firstFramePosition.y+"px",width:n,height:t,overflow:"hidden"}),r.$el.append(r.$anim)},r.setFrameRate=function(e){return r.frameRate=e,r.frameDelay=1e3/e,r},r.play=function(){return r.running=!0,r.options.currentSequence.reverse=!1,r.delayNextFrame(),r},r.rewind=function(){return r.running=!0,r.options.currentSequence.reverse=!0,r.delayPrevFrame(),r},r.stop=function(){return r.timeout&&clearTimeout(r.timeout),r.running=!1,r},r.reset=function(){return r.stop(),r.currentFrameIndex=0,r.gotoFrame(0),r},r.gotoFrame=function(e){var n=-r.options.currentSequence.firstFramePosition.x;"x"===r.options.orientation&&(n=-e*(r.options.frameWidth+r.options.frameSpacing)-r.options.currentSequence.firstFramePosition.x);var t=-r.options.currentSequence.firstFramePosition.y;return"y"===r.options.orientation&&(t=-e*(r.options.frameHeight+r.options.frameSpacing)-r.options.currentSequence.firstFramePosition.y),r.$anim.css({backgroundPosition:n+"px "+t+"px"}),r.options.currentSequence.reverse?r.delayPrevFrame():r.delayNextFrame(),r},r.nextFrame=function(){return++r.currentFrameIndex<r.options.currentSequence.duration?r.gotoFrame(r.currentFrameIndex):r.options.currentSequence.loop?(r.currentFrameIndex=0,r.$el.trigger("spriteAnimation:loop"),r.$el.trigger("spriteAnimation:loop-to-start"),r.gotoFrame(r.currentFrameIndex)):(r.complete(),r.stop())},r.prevFrame=function(){return--r.currentFrameIndex>=0?r.gotoFrame(r.currentFrameIndex):r.options.currentSequence.loop?(r.currentFrameIndex=r.options.currentSequence.duration,r.$el.trigger("spriteAnimation:loop"),r.$el.trigger("spriteAnimation:loop-to-end"),r.gotoFrame(r.currentFrameIndex)):(r.complete(),r.stop())},r.delayNextFrame=function(){r.running&&(r.timeout=setTimeout(function(){r.nextFrame()},r.frameDelay))},r.delayPrevFrame=function(){r.running&&(r.timeout=setTimeout(function(){r.prevFrame()},r.frameDelay))},r.addSequence=function(n){r.options.sequences[n.label]=e.extend({},r.options.defaultSequence,n)},r.complete=function(){"function"==typeof r.options.currentSequence.onComplete&&r.options.currentSequence.onComplete(),r.$el.trigger("spriteAnimation:complete"),r.$el.trigger("spriteAnimation:complete:"+r.options.currentSequence.label)},r.init(),r},e.spriteAnimation.options={src:"",sequences:{},defaultSequence:{label:"a",first:0,duration:25,loop:!1,firstFramePosition:{x:0,y:0},reverse:!1,onComplete:null},orientation:"x",frameWidth:25,frameHeight:25,frameSpacing:0,frameRate:25,gotoAndPlay:"a"},e.fn.spriteAnimation=function(n){return this.each(function(){var t,r,o=e(this);if(n=n||{},!(r=this.spriteAnimation)){if(!n.src){if(!(n.src=o.css("backgroundImage"))&&!(n.src=o.attr("src")))return console?console.error("SpriteAnimation requires image src."):!1,this;o.css("backgroundImage","none"),o.attr("src",""),"url("===n.src.substr(0,4)&&(n.src=n.src.replace("url(","").replace(")",""))}this.spriteAnimation=r=new e.spriteAnimation(this,t),n.addSequences||n.addSequence?t=e.extend({},e.spriteAnimation.options,n):(t=e.extend({},e.spriteAnimation.options),n.label=n.label||"a",n.addSequence=e.extend({},n,{addSequence:null}),n.setSequence=n.label)}return n&&"object"==typeof n&&(e.extend(r.options,n),n.addSequences&&e.each(n.addSequences,function(e){this.label=e,r.addSequence(this)}),n.addSequence&&r.addSequence(n.addSequence),n.gotoAndPlay&&(n.setSequence=n.gotoAndPlay,n.command="play"),n.setSequence&&(r.options.currentSequence=r.options.sequences[n.setSequence],n.gotoFrame=n.gotoFrame||0),r.$anim||r.generate(),n.frameRate&&r.setFrameRate(n.frameRate),(n.gotoFrame>=0||n.gotoFrame)&&("end"===n.gotoFrame&&(n.gotoFrame=r.options.currentSequence.duration-1),r.stop(),r.currentFrameIndex=n.gotoFrame,r.gotoFrame(n.gotoFrame)),n.frameRatio&&r.gotoFrame(n.frameRatio*r.options.currentSequence.duration>>0),n.command&&(n=n.command)),n&&"string"==typeof n?(r.$anim||r.generate(),"play"===n&&r.play(),"rewind"===n&&r.rewind(),"stop"===n&&r.stop(),"reset"===n&&r.reset()):n&&!isNaN(parseInt(n,10))?r.gotoFrame(n):n||r.reset(),this})}})(jQuery);